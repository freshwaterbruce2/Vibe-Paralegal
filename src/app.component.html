<!-- This outer conditional handles the mobile upload view vs the main app -->
@if (activeTab() === 'mobile-upload') {
  <app-mobile-upload />
} @else {
  <main class="bg-gray-900 text-gray-200 font-sans flex h-screen antialiased">
    <!-- Left Panel: Navigation -->
    <aside class="w-64 flex-shrink-0 flex flex-col p-4 bg-gray-950/70 border-r border-gray-800 overflow-y-auto">
      <header class="mb-8 p-2">
        <h1 class="text-xl font-bold text-white text-center">
          AI PARALEGAL ASSISTANT
        </h1>
        <p class="text-xs text-gray-500 mt-1 text-center">Employment & Family Law</p>
      </header>

      <nav class="flex flex-col space-y-2 flex-grow">
        <!-- Employment Law Section -->
        <h3 class="px-4 pt-4 pb-2 text-xs font-semibold text-gray-500 uppercase">Employment Case</h3>
        <button (click)="setActiveTab('details')" [class.bg-blue-600/20]="activeTab() === 'details'" [class.text-blue-300]="activeTab() === 'details'" [class.hover:bg-gray-800/60]="activeTab() !== 'details'" class="flex items-center px-4 py-2 rounded-md text-gray-300 transition-colors duration-200 w-full text-left">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3" viewBox="0 0 20 20" fill="currentColor"><path d="M10 2a4 4 0 00-4 4v1H5a1 1 0 00-.993.883L4 8v9a1 1 0 001 1h10a1 1 0 001-1V8l-.007-.117A1 1 0 0015 7h-1V6a4 4 0 00-4-4zm2 5H8V6a2 2 0 114 0v1z" /></svg>
          Case Details
        </button>
        <button (click)="setActiveTab('documents')" [class.bg-blue-600/20]="activeTab() === 'documents'" [class.text-blue-300]="activeTab() === 'documents'" [class.hover:bg-gray-800/60]="activeTab() !== 'documents'" class="flex items-center px-4 py-2 rounded-md text-gray-300 transition-colors duration-200 w-full text-left">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 6a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 3a1 1 0 100 2h6a1 1 0 100-2H7z" clip-rule="evenodd" /></svg>
          Documents
        </button>
        <button (click)="setActiveTab('analyzer')" [class.bg-blue-600/20]="activeTab() === 'analyzer'" [class.text-blue-300]="activeTab() === 'analyzer'" [class.hover:bg-gray-800/60]="activeTab() !== 'analyzer'" class="flex items-center px-4 py-2 rounded-md text-gray-300 transition-colors duration-200 w-full text-left">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" /><path stroke-linecap="round" stroke-linejoin="round" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
          File Analyzer
        </button>
        <button (click)="setActiveTab('timeline')" [class.bg-blue-600/20]="activeTab() === 'timeline'" [class.text-blue-300]="activeTab() === 'timeline'" [class.hover:bg-gray-800/60]="activeTab() !== 'timeline'" class="flex items-center px-4 py-2 rounded-md text-gray-300 transition-colors duration-200 w-full text-left">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.414-1.414L11 10.586V6z" clip-rule="evenodd" /></svg>
          Master Timeline
        </button>
        <button (click)="setActiveTab('actions')" [class.bg-blue-600/20]="activeTab() === 'actions'" [class.text-blue-300]="activeTab() === 'actions'" [class.hover:bg-gray-800/60]="activeTab() !== 'actions'" class="flex items-center px-4 py-2 rounded-md text-gray-300 transition-colors duration-200 w-full text-left">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3" viewBox="0 0 20 20" fill="currentColor"><path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z" /><path fill-rule="evenodd" d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3zm-3 4a1 1 0 100 2h.01a1 1 0 100-2H7zm3 0a1 1 0 100 2h3a1 1 0 100-2h-3z" clip-rule="evenodd" /></svg>
          Action Tracker
        </button>
        <button (click)="setActiveTab('evidence')" [class.bg-blue-600/20]="activeTab() === 'evidence'" [class.text-blue-300]="activeTab() === 'evidence'" [class.hover:bg-gray-800/60]="activeTab() !== 'evidence'" class="flex items-center px-4 py-2 rounded-md text-gray-300 transition-colors duration-200 w-full text-left">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 6a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 3a1 1 0 100 2h6a1 1 0 100-2H7z" clip-rule="evenodd" /></svg>
          Evidence Log
        </button>
        <button (click)="setActiveTab('contacts')" [class.bg-blue-600/20]="activeTab() === 'contacts'" [class.text-blue-300]="activeTab() === 'contacts'" [class.hover:bg-gray-800/60]="activeTab() !== 'contacts'" class="flex items-center px-4 py-2 rounded-md text-gray-300 transition-colors duration-200 w-full text-left">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3" viewBox="0 0 20 20" fill="currentColor"><path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z" /></svg>
          Contact Log
        </button>
         <button (click)="setActiveTab('deadlines')" [class.bg-blue-600/20]="activeTab() === 'deadlines'" [class.text-blue-300]="activeTab() === 'deadlines'" [class.hover:bg-gray-800/60]="activeTab() !== 'deadlines'" class="flex items-center px-4 py-2 rounded-md text-gray-300 transition-colors duration-200 w-full text-left">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd" /></svg>
          Deadline Calendar
        </button>
         <button (click)="setActiveTab('damages')" [class.bg-blue-600/20]="activeTab() === 'damages'" [class.text-blue-300]="activeTab() === 'damages'" [class.hover:bg-gray-800/60]="activeTab() !== 'damages'" class="flex items-center px-4 py-2 rounded-md text-gray-300 transition-colors duration-200 w-full text-left">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3" viewBox="0 0 20 20" fill="currentColor"><path d="M8.433 7.418c.155-.103.346-.196.567-.267v1.698a2.5 2.5 0 00-1.134 0V7.418zM10 16.5a2.5 2.5 0 001.134 0v-1.698c-.155.103-.346.196-.567.267a.5.5 0 01-.567-.267v-1.698a2.5 2.5 0 00-1.134 0v1.698a.5.5 0 01.567.267c.22.07.412.164.567.267v1.698z" /><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm.5-14a.5.5 0 00-1 0V5a.5.5 0 001 0V4zM10 6.5A2.502 2.502 0 007.5 9v1.418a.5.5 0 01-.567.424c-.22.07-.412.164-.567.267a2.5 2.5 0 000 2.782c.155.103.347.196.567.267a.5.5 0 01.567.424V15.5a2.5 2.5 0 005 0v-1.418a.5.5 0 01.567-.424c.22-.07.412.164-.567-.267a2.5 2.5 0 000-2.782c-.155-.103-.347-.196-.567-.267a.5.5 0 01-.567-.424V9A2.502 2.502 0 0010 6.5zm0 1.5a1 1 0 100 2 1 1 0 000-2z" clip-rule="evenodd" /></svg>
          Damage Calculator
        </button>

        <!-- Family Law Section -->
        <h3 class="px-4 pt-4 pb-2 text-xs font-semibold text-gray-500 uppercase">Family Law Case</h3>
        <button (click)="setActiveTab('family')" [class.bg-purple-600/20]="activeTab() === 'family'" [class.text-purple-300]="activeTab() === 'family'" [class.hover:bg-gray-800/60]="activeTab() !== 'family'" class="flex items-center px-4 py-2 rounded-md text-gray-300 transition-colors duration-200 w-full text-left">
           <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3" viewBox="0 0 20 20" fill="currentColor">
              <path d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z" />
            </svg>
          Family Law Center
        </button>
        
        <!-- AI & Analysis Section -->
        <h3 class="px-4 pt-4 pb-2 text-xs font-semibold text-gray-500 uppercase">AI Tools</h3>
         <button (click)="setActiveTab('chat')" [class.bg-green-600/20]="activeTab() === 'chat'" [class.text-green-300]="activeTab() === 'chat'" [class.hover:bg-gray-800/60]="activeTab() !== 'chat'" class="flex items-center px-4 py-2 rounded-md text-gray-300 transition-colors duration-200 w-full text-left">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.083-3.083A6.984 6.984 0 012 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM4.79 14.243A6.975 6.975 0 014 10c0-3.309 3.134-6 7-6s7 2.691 7 6-3.134 6-7 6a7.735 7.735 0 01-2.21-.336L4.79 14.243z" clip-rule="evenodd" /></svg>
          AI Paralegal
        </button>
        <button (click)="setActiveTab('violations')" [class.bg-red-600/20]="activeTab() === 'violations'" [class.text-red-300]="activeTab() === 'violations'" [class.hover:bg-gray-800/60]="activeTab() !== 'violations'" class="flex items-center px-4 py-2 rounded-md text-gray-300 transition-colors duration-200 w-full text-left">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M8.257 3.099c.625-1.096 2.26-1.096 2.886 0l5.58 9.79c.64 1.12-1.84 2.18-2.44 1.12L10 6.32l-4.283 7.69c-.6 1.06-3.08.001-2.44-1.12l5.58-9.79zM10 14a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd" /></svg>
          Violation Analysis
        </button>
      </nav>

      <!-- Export and Settings Buttons -->
      <div class="mt-auto space-y-2">
         <button (click)="exportCaseFile()" class="flex items-center px-4 py-2 rounded-md text-gray-400 hover:bg-gray-800/60 hover:text-gray-200 transition-colors duration-200 w-full text-left">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" />
          </svg>
          Export Case File
        </button>
         <button (click)="toggleSettings()" class="flex items-center px-4 py-2 rounded-md text-gray-400 hover:bg-gray-800/60 hover:text-gray-200 transition-colors duration-200 w-full text-left">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-1.57 1.996A1.532 1.532 0 013 8.22v3.56c0 .64.327 1.24.872 1.574.986.636 2.04.143 2.551 1.026.512.884.23 2.02-.644 2.551-.873.532-1.175 1.625-.643 2.55a1.532 1.532 0 01.947 2.286c-.835 1.372.734 2.942 1.996 1.57.726-.441 1.573-.553 2.286-.948 1.56.38 1.56 2.6 0 2.98a1.532 1.532 0 01-.948 2.286c.836 1.372 2.942-.734 1.57-1.996A1.532 1.532 0 0117 11.78V8.22c0-.64-.327-1.24-.872-1.574-.986-.636-2.04-.143-2.551-1.026-.512-.884-.23-2.02.644-2.551.873.532 1.175 1.625-.643 2.55a1.532 1.532 0 01-.947-2.286c.835-1.372-.734-2.942-1.996-1.57a1.532 1.532 0 01-2.286.948zM10 13a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd" /></svg>
          Settings
        </button>
      </div>
    </aside>

    <!-- Right Panel: Main Content -->
    <section class="flex-grow flex flex-col h-full bg-gray-800/50">
      @switch (activeTab()) {
        @case ('details') { <app-case-details /> }
        @case ('documents') { <app-document-viewer /> }
        @case ('analyzer') { <app-file-analyzer /> }
        @case ('chat') { <app-chat /> }
        @case ('timeline') { <app-timeline-editor /> }
        @case ('actions') { <app-action-tracker /> }
        @case ('evidence') { <app-evidence-log /> }
        @case ('contacts') { <app-contact-log /> }
        @case ('deadlines') { <app-deadline-calendar /> }
        @case ('damages') { <app-damage-calculator /> }
        @case ('violations') { <app-violation-analysis /> }
        @case ('family') { <app-family-law /> }
      }
    </section>

    <!-- Settings Modal -->
    @if (isSettingsOpen()) {
      <div class="fixed inset-0 bg-black/60 z-40 flex items-center justify-center" (click)="toggleSettings()">
        <div class="bg-gray-900 border border-gray-700 rounded-lg shadow-xl w-full max-w-md p-6" (click)="$event.stopPropagation()">
          <div class="flex items-center justify-between mb-6">
            <h2 class="text-xl font-bold text-white">Settings</h2>
            <button (click)="toggleSettings()" class="text-gray-400 hover:text-white">&times;</button>
          </div>
          <div class="space-y-6">
            <div>
              <label for="deepseekApiKey" class="block text-sm font-medium text-gray-300">Deepseek API Key</label>
              <input type="password" id="deepseekApiKey" [value]="settings.deepseekApiKey()" (input)="handleSettingsInput('deepseekApiKey', $event)" placeholder="Enter your API key" class="w-full mt-1 p-2 bg-gray-700 border border-gray-600 rounded-md focus:ring-2 focus:ring-blue-500">
              <p class="text-xs text-gray-500 mt-1">Your key is stored securely in your browser's local storage.</p>
            </div>

            <hr class="border-gray-700">

            <h3 class="text-lg font-semibold text-white">Notifications</h3>
            <div>
              <label for="userEmail" class="block text-sm font-medium text-gray-300">Email Address for Alerts</label>
              <input type="email" id="userEmail" [value]="settings.userEmail()" (input)="handleSettingsInput('userEmail', $event)" placeholder="your.email@example.com" class="w-full mt-1 p-2 bg-gray-700 border border-gray-600 rounded-md focus:ring-2 focus:ring-blue-500">
              <p class="text-xs text-gray-500 mt-1">Simulated: Emails will appear as on-screen notifications.</p>
            </div>
            <div class="relative flex items-start">
              <div class="flex h-6 items-center">
                <input id="notifyOnViolations" type="checkbox" [checked]="settings.notifyOnViolations()" (change)="handleSettingsInput('notifyOnViolations', $event)" class="h-4 w-4 rounded border-gray-500 bg-gray-700 text-blue-600 focus:ring-blue-600">
              </div>
              <div class="ml-3 text-sm leading-6">
                <label for="notifyOnViolations" class="font-medium text-gray-300">Notify on new high-severity violations</label>
                <p class="text-gray-400">Get an alert when the AI finds a new high-priority issue.</p>
              </div>
            </div>
            <div class="relative flex items-start">
              <div class="flex h-6 items-center">
                <input id="notifyOnDeadlines" type="checkbox" [checked]="settings.notifyOnDeadlines()" (change)="handleSettingsInput('notifyOnDeadlines', $event)" class="h-4 w-4 rounded border-gray-500 bg-gray-700 text-blue-600 focus:ring-blue-600">
              </div>
              <div class="ml-3 text-sm leading-6">
                <label for="notifyOnDeadlines" class="font-medium text-gray-300">Notify on critical deadlines</label>
                <p class="text-gray-400">Get an alert for critical deadlines within the next 30 days.</p>
              </div>
            </div>
          </div>
           <div class="mt-8 text-right">
              <button (click)="toggleSettings()" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-500">Close</button>
          </div>
        </div>
      </div>
    }

    <!-- Toast Notifications Container -->
    <div aria-live="assertive" class="pointer-events-none fixed inset-0 flex items-end px-4 py-6 sm:items-start sm:p-6 z-50">
      <div class="flex w-full flex-col items-center space-y-4 sm:items-end">
        @for (toast of notificationService.toasts(); track toast.id) {
          <div class="pointer-events-auto w-full max-w-sm overflow-hidden rounded-lg bg-gray-800 shadow-lg ring-1 ring-black ring-opacity-5 border border-gray-700">
            <div class="p-4">
              <div class="flex items-start">
                <div class="flex-shrink-0">
                  @switch (toast.type) {
                    @case ('success') {
                      <svg class="h-6 w-6 text-green-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                      </svg>
                    }
                    @case ('error') {
                       <svg class="h-6 w-6 text-red-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" />
                      </svg>
                    }
                    @case ('info') {
                      <svg class="h-6 w-6 text-blue-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M21.75 6.75v10.5a2.25 2.25 0 01-2.25-2.25h-15a2.25 2.25 0 01-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25m19.5 0v.243a2.25 2.25 0 01-1.07 1.916l-7.5 4.615a2.25 2.25 0 01-2.36 0L3.32 8.91a2.25 2.25 0 01-1.07-1.916V6.75" />
                      </svg>
                    }
                  }
                </div>
                <div class="ml-3 w-0 flex-1 pt-0.5">
                  <p class="text-sm font-medium text-gray-100">{{ toast.title }}</p>
                  <p class="mt-1 text-sm text-gray-400">{{ toast.message }}</p>
                </div>
                <div class="ml-4 flex flex-shrink-0">
                  <button (click)="notificationService.removeToast(toast.id)" type="button" class="inline-flex rounded-md bg-gray-800 text-gray-400 hover:text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 focus:ring-offset-gray-800">
                    <span class="sr-only">Close</span>
                    <svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true"><path d="M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z" /></svg>
                  </button>
                </div>
              </div>
            </div>
          </div>
        }
      </div>
    </div>
  </main>
}
