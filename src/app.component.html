<main class="bg-gray-900 text-gray-200 font-sans flex h-screen antialiased">

  <!-- Left Panel: Navigation -->
  <aside class="w-64 flex-shrink-0 flex flex-col p-4 bg-gray-950/70 border-r border-gray-800">
    <header class="mb-8 p-2">
      <h1 class="text-xl font-bold text-white text-center">
        BRUCE'S WALMART CASE TRACKING SYSTEM
      </h1>
      <p class="text-xs text-gray-500 mt-1 text-center">Simple. Organized. Effective.</p>
    </header>

    <nav class="flex flex-col space-y-2">
       <button (click)="setActiveTab('chat')" [class.bg-blue-600/20]="activeTab() === 'chat'" [class.text-blue-300]="activeTab() === 'chat'" [class.hover:bg-gray-800/60]="activeTab() !== 'chat'" class="flex items-center px-4 py-2 rounded-md text-gray-300 transition-colors duration-200 w-full text-left">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.083-3.083A6.984 6.984 0 012 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM4.79 14.243A6.975 6.975 0 014 10c0-3.309 3.134-6 7-6s7 2.691 7 6-3.134 6-7 6a7.735 7.735 0 01-2.21-.336L4.79 14.243z" clip-rule="evenodd" /></svg>
        AI Paralegal
      </button>
      <button (click)="setActiveTab('timeline')" [class.bg-blue-600/20]="activeTab() === 'timeline'" [class.text-blue-300]="activeTab() === 'timeline'" [class.hover:bg-gray-800/60]="activeTab() !== 'timeline'" class="flex items-center px-4 py-2 rounded-md text-gray-300 transition-colors duration-200 w-full text-left">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.414-1.414L11 10.586V6z" clip-rule="evenodd" /></svg>
        Master Timeline
      </button>
      <button (click)="setActiveTab('actions')" [class.bg-blue-600/20]="activeTab() === 'actions'" [class.text-blue-300]="activeTab() === 'actions'" [class.hover:bg-gray-800/60]="activeTab() !== 'actions'" class="flex items-center px-4 py-2 rounded-md text-gray-300 transition-colors duration-200 w-full text-left">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3" viewBox="0 0 20 20" fill="currentColor"><path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z" /><path fill-rule="evenodd" d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3zm-3 4a1 1 0 100 2h.01a1 1 0 100-2H7zm3 0a1 1 0 100 2h3a1 1 0 100-2h-3z" clip-rule="evenodd" /></svg>
        Action Tracker
      </button>
      <button (click)="setActiveTab('evidence')" [class.bg-blue-600/20]="activeTab() === 'evidence'" [class.text-blue-300]="activeTab() === 'evidence'" [class.hover:bg-gray-800/60]="activeTab() !== 'evidence'" class="flex items-center px-4 py-2 rounded-md text-gray-300 transition-colors duration-200 w-full text-left">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 6a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 3a1 1 0 100 2h6a1 1 0 100-2H7z" clip-rule="evenodd" /></svg>
        Evidence Log
      </button>
      <button (click)="setActiveTab('contacts')" [class.bg-blue-600/20]="activeTab() === 'contacts'" [class.text-blue-300]="activeTab() === 'contacts'" [class.hover:bg-gray-800/60]="activeTab() !== 'contacts'" class="flex items-center px-4 py-2 rounded-md text-gray-300 transition-colors duration-200 w-full text-left">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3" viewBox="0 0 20 20" fill="currentColor"><path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z" /></svg>
        Contact Log
      </button>
       <button (click)="setActiveTab('deadlines')" [class.bg-blue-600/20]="activeTab() === 'deadlines'" [class.text-blue-300]="activeTab() === 'deadlines'" [class.hover:bg-gray-800/60]="activeTab() !== 'deadlines'" class="flex items-center px-4 py-2 rounded-md text-gray-300 transition-colors duration-200 w-full text-left">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd" /></svg>
        Deadline Calendar
      </button>
       <button (click)="setActiveTab('damages')" [class.bg-blue-600/20]="activeTab() === 'damages'" [class.text-blue-300]="activeTab() === 'damages'" [class.hover:bg-gray-800/60]="activeTab() !== 'damages'" class="flex items-center px-4 py-2 rounded-md text-gray-300 transition-colors duration-200 w-full text-left">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3" viewBox="0 0 20 20" fill="currentColor"><path d="M8.433 7.418c.155-.103.346-.196.567-.267v1.698a2.5 2.5 0 00-1.134 0V7.418zM10 16.5a2.5 2.5 0 001.134 0v-1.698c-.155.103-.346.196-.567.267a.5.5 0 01-.567-.267v-1.698a2.5 2.5 0 00-1.134 0v1.698a.5.5 0 01.567.267c.22.07.412.164.567.267v1.698z" /><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm.5-14a.5.5 0 00-1 0V5a.5.5 0 001 0V4zM10 6.5A2.502 2.502 0 007.5 9v1.418a.5.5 0 01-.567.424c-.22.07-.412.164-.567.267a2.5 2.5 0 000 2.782c.155.103.347.196.567.267a.5.5 0 01.567.424V15.5a2.5 2.5 0 005 0v-1.418a.5.5 0 01.567-.424c.22-.07.412-.164.567-.267a2.5 2.5 0 000-2.782c-.155-.103-.347-.196-.567-.267a.5.5 0 01-.567-.424V9A2.502 2.502 0 0010 6.5zm0 1.5a1 1 0 100 2 1 1 0 000-2z" clip-rule="evenodd" /></svg>
        Damage Calculator
      </button>
    </nav>
  </aside>

  <!-- Right Panel: Main Content -->
  <section class="flex-grow flex flex-col h-full bg-gray-800/50">
    @switch (activeTab()) {
      @case ('chat') {
        <div #chatContainer class="flex-grow p-6 overflow-y-auto">
          <div class="flex flex-col space-y-4">
            @for (message of messages(); track $index) {
              <div class="flex" [class.justify-end]="message.role === 'user'" [class.justify-start]="message.role === 'model'">
                <div class="max-w-2xl px-4 py-3 rounded-xl" [class.bg-blue-600]="message.role === 'user'" [class.bg-gray-700]="message.role === 'model'">
                  @if (message.role === 'model') {
                    <div class="prose prose-sm max-w-none prose-invert" [innerHTML]="formatMessageText(message.text)"></div>
                  } @else {
                    <p class="text-white">{{ message.text }}</p>
                  }
                </div>
              </div>
            }
            @if (loading() && messages()[messages().length - 1]?.text === '') {
              <div class="flex justify-start">
                 <div class="max-w-2xl px-4 py-3 rounded-xl bg-gray-700 flex items-center space-x-2">
                    <div class="w-2 h-2 bg-gray-400 rounded-full animate-pulse [animation-delay:-0.3s]"></div>
                    <div class="w-2 h-2 bg-gray-400 rounded-full animate-pulse [animation-delay:-0.15s]"></div>
                    <div class="w-2 h-2 bg-gray-400 rounded-full animate-pulse"></div>
                </div>
              </div>
            }
          </div>
        </div>

        @if (error()) {
          <div class="px-6 pb-2">
            <div class="bg-red-500/20 border border-red-500 text-red-300 px-4 py-3 rounded-md" role="alert">
              <p>{{ error() }}</p>
            </div>
          </div>
        }

        <div class="p-6 border-t border-gray-700 bg-gray-900/50">
          <form class="flex items-center space-x-4" (submit)="$event.preventDefault(); sendMessage()">
            <textarea
              class="flex-grow p-3 bg-gray-700 border border-gray-600 rounded-md focus:ring-2 focus:ring-blue-500 focus:outline-none resize-none text-gray-200 placeholder-gray-400 disabled:opacity-50"
              placeholder="Ask a question or describe the focus of your action plan..."
              rows="1"
              [value]="chatPrompt()"
              (input)="handlePromptInput($event)"
              (keydown.enter)="$event.preventDefault(); sendMessage()"
              [disabled]="loading()"
            ></textarea>
            <button
              type="button"
              (click)="generateActionPlan()"
              class="bg-gray-600 text-gray-200 p-3 rounded-md hover:bg-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-900 focus:ring-blue-500 disabled:bg-gray-700 disabled:cursor-not-allowed transition-colors duration-200"
              [disabled]="loading()"
              title="Generate Action Plan"
            >
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" />
              </svg>
            </button>
            <button
              type="submit"
              class="bg-blue-600 text-white p-3 rounded-md hover:bg-blue-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-900 focus:ring-blue-500 disabled:bg-blue-800 disabled:cursor-not-allowed transition-colors duration-200"
              [disabled]="loading() || !chatPrompt().trim()"
              title="Send Message"
            >
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 transform -rotate-90" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
              </svg>
            </button>
          </form>
        </div>
      }
      @case ('timeline') {
        <div class="p-8 overflow-y-auto">
          <h2 class="text-3xl font-bold mb-6 text-gray-100">Master Timeline</h2>
           <div class="bg-gray-900/50 rounded-lg border border-gray-700 p-6">
              <div class="prose prose-invert max-w-none">
                <p>This is the master source of truth for your case. It contains every key date and event. The AI Paralegal uses this as its primary context. You can edit it below.</p>
              </div>
              <textarea 
                  class="w-full h-96 mt-4 p-3 bg-gray-950/50 border border-gray-600 rounded-md focus:ring-2 focus:ring-blue-500 focus:outline-none resize-y text-gray-300 placeholder-gray-500"
                  [value]="masterTimeline()"
                  (input)="handleTimelineInput($event)"
              ></textarea>
           </div>
        </div>
      }
      @case ('actions') {
         <div class="p-8 overflow-y-auto">
          <h2 class="text-3xl font-bold mb-6 text-gray-100">Daily Action Tracker</h2>
            <div class="bg-gray-900/50 rounded-lg border border-gray-700 p-6 prose prose-invert max-w-none">
                <h3 class="text-lg font-semibold text-gray-300">DATE: November 16, 2025 (Saturday)</h3>
                
                <h4 class="font-bold mt-4">MUST DO TODAY:</h4>
                <ul class="space-y-2">
                    <li><input type="checkbox" class="mr-2">Meet with Christina about religious accommodation</li>
                    <li><input type="checkbox" class="mr-2">Ask about accommodation case status (open vs closed?)</li>
                    <li><input type="checkbox" class="mr-2">Get case closure in WRITING if they say it's closed</li>
                    <li><input type="checkbox" class="mr-2">Document everything Christina says</li>
                    <li><input type="checkbox" class="mr-2">Note any physical issues with work</li>
                    <li><input type="checkbox" class="mr-2">Ask about insurance premium deductions</li>
                </ul>

                <h4 class="font-bold mt-6">QUESTIONS TO ASK:</h4>
                <ol class="list-decimal list-inside space-y-1">
                    <li>"Case C5830D8173-0001-01 - Sedgwick says open until 11/22, you say closed. Which is it?"</li>
                    <li>"Religious accommodation - what's the timeline for decision?"</li>
                    <li>"My insurance was terminated June 30 during FMLA. Why? How will you fix it?"</li>
                    <li>"Is this position permanent or temporary?"</li>
                    <li>"Same physical requirements as before?"</li>
                </ol>

                <h4 class="font-bold mt-6">DOCUMENT AFTER:</h4>
                 <ul class="list-disc list-inside space-y-1">
                    <li>Who I met with</li>
                    <li>What they said (exact words if possible)</li>
                    <li>Any commitments made</li>
                    <li>How my back felt during work</li>
                    <li>Follow-up needed</li>
                </ul>
            </div>
        </div>
      }
      @case ('evidence') {
        <div class="p-8 overflow-y-auto">
          <h2 class="text-3xl font-bold mb-6 text-gray-100">Evidence Tracking Log</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="bg-gray-900/50 rounded-lg border border-gray-700 p-6 prose prose-invert max-w-none">
                    <h3 class="text-lg font-semibold text-green-400">HAVE:</h3>
                    <ul class="space-y-2 mt-4">
                        <li><input type="checkbox" checked class="mr-2">July 14 accommodation denial letter (CRITICAL)</li>
                        <li><input type="checkbox" checked class="mr-2">August 19 accommodation approval letter</li>
                        <li><input type="checkbox" checked class="mr-2">All Sedgwick letters (July-October)</li>
                        <li><input type="checkbox" checked class="mr-2">Medical records from Colonial Healthcare</li>
                        <li><input type="checkbox" checked class="mr-2">Dr. Becksvoort notes and restrictions</li>
                        <li><input type="checkbox" checked class="mr-2">X-ray results (degenerative disc disease)</li>
                        <li><input type="checkbox" checked class="mr-2">September 5 STD payment stub (no insurance deduction)</li>
                        <li><input type="checkbox" checked class="mr-2">November 15 email to Christina/Tichala</li>
                    </ul>
                </div>
                 <div class="bg-gray-900/50 rounded-lg border border-gray-700 p-6 prose prose-invert max-w-none">
                    <h3 class="text-lg font-semibold text-yellow-400">NEED TO GET:</h3>
                    <ul class="space-y-2 mt-4">
                        <li><input type="checkbox" class="mr-2">Blue Cross Blue Shield termination date (exact)</li>
                        <li><input type="checkbox" class="mr-2">Blue Cross denial of reinstatement (in writing)</li>
                        <li><input type="checkbox" class="mr-2">All STD payment stubs May-October (check for premium deductions)</li>
                        <li><input type="checkbox" class="mr-2">Private insurance policy and premium amounts</li>
                        <li><input type="checkbox" class="mr-2">Accommodation case closure letter (if they say it's closed)</li>
                        <li><input type="checkbox" class="mr-2">Religious accommodation decision (when made)</li>
                    </ul>
                </div>
            </div>
        </div>
      }
      @case ('contacts') {
        <div class="p-8 overflow-y-auto">
          <h2 class="text-3xl font-bold mb-6 text-gray-100">Contact Log</h2>
          <div class="space-y-6">
            <div class="bg-gray-900/50 rounded-lg border border-gray-700 p-6 prose prose-invert max-w-none">
              <p class="text-sm text-gray-400">DATE: November 15, 2025 (evening) | PERSON: T'Challa (Walmart HR) | METHOD: Phone call</p>
              <h4 class="font-bold mt-2">WHAT THEY SAID:</h4>
              <ul class="list-disc list-inside">
                <li>Come in Saturday 11/16</li>
                <li>Same position (Imports Loader)</li>
                <li>Same pay ($26.40/hour)</li>
                <li>Accommodation case CLOSED</li>
                <li>Religious accommodation through Christina</li>
              </ul>
              <h4 class="font-bold mt-2">FOLLOW-UP NEEDED:</h4>
              <ul class="list-disc list-inside">
                <li>Get case closure in writing</li>
                <li>Clarify with Sedgwick about open vs closed</li>
              </ul>
            </div>
             <div class="bg-gray-900/50 rounded-lg border border-gray-700 p-6 prose prose-invert max-w-none">
              <p class="text-sm text-gray-400">DATE: November 15, 2025 (day) | PERSON: Sedgwick rep | METHOD: Phone call</p>
              <h4 class="font-bold mt-2">WHAT THEY SAID:</h4>
              <ul class="list-disc list-inside">
                 <li>Case C5830D8173-0001-01 STILL OPEN</li>
                 <li>Deadline November 22, 2025</li>
                 <li>Case active through deadline</li>
              </ul>
               <div class="mt-4 border-l-4 border-red-500 pl-4">
                <p class="font-semibold text-red-400">DISCREPANCY NOTED:</p>
                <p class="text-gray-300">T'Challa says closed, Sedgwick says open. There is a 6-day gap to the deadline.</p>
               </div>
            </div>
          </div>
        </div>
      }
      @case ('deadlines') {
        <div class="p-8 overflow-y-auto">
          <h2 class="text-3xl font-bold mb-6 text-gray-100">Deadline Calendar</h2>
          <div class="bg-gray-900/50 rounded-lg border border-gray-700">
            <table class="w-full text-left">
              <thead class="bg-gray-800/50">
                <tr>
                  <th class="p-4 font-semibold">Date</th>
                  <th class="p-4 font-semibold">What</th>
                  <th class="p-4 font-semibold">Action Required</th>
                  <th class="p-4 font-semibold">Status</th>
                </tr>
              </thead>
              <tbody class="divide-y divide-gray-700">
                <tr>
                  <td class="p-4 font-bold text-yellow-300">Nov 16, 2025</td>
                  <td class="p-4">Meet Christina</td>
                  <td class="p-4">Ask questions, document everything</td>
                  <td class="p-4"><span class="px-2 py-1 text-xs font-semibold bg-yellow-500/20 text-yellow-300 rounded-full">TODAY</span></td>
                </tr>
                <tr>
                  <td class="p-4">Nov 18, 2025</td>
                  <td class="p-4">Monday follow-up</td>
                  <td class="p-4">Call Blue Cross, call Sedgwick if needed</td>
                  <td class="p-4"><span class="px-2 py-1 text-xs font-semibold bg-gray-600/50 text-gray-300 rounded-full">Pending</span></td>
                </tr>
                <tr>
                  <td class="p-4">Nov 22, 2025</td>
                  <td class="p-4">Accommodation deadline</td>
                  <td class="p-4">Monitor for communication</td>
                  <td class="p-4"><span class="px-2 py-1 text-xs font-semibold bg-gray-600/50 text-gray-300 rounded-full">Pending</span></td>
                </tr>
                <tr>
                  <td class="p-4">Dec 16, 2025</td>
                  <td class="p-4">30 days from return</td>
                  <td class="p-4">Check religious accommodation status</td>
                  <td class="p-4"><span class="px-2 py-1 text-xs font-semibold bg-gray-700 text-gray-400 rounded-full">Future</span></td>
                </tr>
                 <tr class="border-t-2 border-red-500/50">
                  <td class="p-4 font-bold text-red-400">May 10, 2026</td>
                  <td class="p-4 font-semibold">EEOC deadline</td>
                  <td class="p-4">300 days from July 14 denial</td>
                  <td class="p-4"><span class="px-2 py-1 text-xs font-semibold bg-red-500/20 text-red-300 rounded-full">CRITICAL</span></td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      }
       @case ('damages') {
        <div class="p-8 overflow-y-auto">
          <h2 class="text-3xl font-bold mb-6 text-gray-100">Damage Calculator (Running Total)</h2>
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <div class="bg-gray-900/50 rounded-lg border border-gray-700 p-6">
                <h3 class="text-lg font-semibold text-gray-300">Lost Wages</h3>
                <p class="text-sm text-gray-400">$26.40/hr Ã— 40 hrs/wk = $1,056/week</p>
                <p class="text-4xl font-bold text-green-400 mt-4">$18,900 <span class="text-lg font-normal text-gray-400">(~18 weeks)</span></p>
            </div>
             <div class="bg-gray-900/50 rounded-lg border border-gray-700 p-6">
                <h3 class="text-lg font-semibold text-gray-300">Insurance Costs</h3>
                 <p class="text-sm text-gray-400">Private insurance premium payments</p>
                 <p class="text-4xl font-bold text-yellow-400 mt-4">$2,500 <span class="text-lg font-normal text-gray-400">(estimate)</span></p>
            </div>
             <div class="bg-gray-900/50 rounded-lg border border-gray-700 p-6">
                <h3 class="text-lg font-semibold text-gray-300">Medical Expenses</h3>
                 <p class="text-sm text-gray-400">Costs incurred while uninsured</p>
                 <p class="text-4xl font-bold text-orange-400 mt-4">$850 <span class="text-lg font-normal text-gray-400">(visits, meds)</span></p>
            </div>
          </div>
           <div class="mt-8 bg-gray-950/80 rounded-lg border-2 border-blue-500 p-6 flex items-center justify-between">
              <h3 class="text-2xl font-bold text-gray-100">Grand Total Damages:</h3>
              <p class="text-5xl font-bold text-blue-300">$22,250</p>
           </div>
        </div>
      }
    }
  </section>

</main>